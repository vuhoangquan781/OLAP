GO
CREATE DATABASE QL_vatlieunhom2
USE QL_vatlieunhom2


CREATE TABLE KHUVUC
(
	MAKV NCHAR(20) NOT NULL,
	TENKV NVARCHAR(100),
	CONSTRAINT PK_VUNGMIEN PRIMARY KEY(MAKV)
)

CREATE TABLE CHINHANH
(
	MACHINHANH NCHAR(20) NOT NULL,
	MAKV NCHAR(20) NOT NULL,
	TENCHINHANH NVARCHAR(200),	
	DIACHI NVARCHAR(100),
	CONSTRAINT PK_CHINHANH PRIMARY KEY(MACHINHANH),
	CONSTRAINT FK_CHINHANH_KHUCVUC FOREIGN KEY(MAKV) REFERENCES KHUVUC(MAKV)
)
CREATE TABLE NHACUNGCAP
(
	MANCC NCHAR(20) NOT NULL,
	TENNCC NVARCHAR(100),
	DIACHI NVARCHAR(100),
	DIENTHOAI INT,
	CONSTRAINT PK_NCC PRIMARY KEY(MANCC)
)
CREATE TABLE NHAPHANG
(
	MANHAPHANG NCHAR(20) NOT NULL,
	MANCC NCHAR(20) NOT NULL,
	MACHINHANH NCHAR(20) NOT NULL,
	SLNHAPHANG INT,	
	NGAYNHAPHANG DATE,
	CONSTRAINT PK_NHAPHANG PRIMARY KEY(MANHAPHANG),
	CONSTRAINT FK_NHAPHANG_NHACUNGCAP FOREIGN KEY(MANCC) REFERENCES NHACUNGCAP(MANCC),
	CONSTRAINT FK_NHAPHANG_CHINHANH FOREIGN KEY(MACHINHANH) REFERENCES CHINHANH(MACHINHANH)
)

CREATE TABLE LOAISANPHAM
(
	MALOAI NCHAR(20) NOT NULL,
	TENLOAI NVARCHAR(100),
	CONSTRAINT PK_LOAISP PRIMARY KEY(MALOAI)
)

CREATE TABLE GIAMGIA
(
	MAGG CHAR(20) NOT NULL,
	MUCGIAMGIA FLOAT,
	GHICHU NVARCHAR(1000),
	CONSTRAINT PK_GIAGIA PRIMARY KEY(MAGG)
)

CREATE TABLE SANPHAM
(
	MASP NCHAR(20) NOT NULL,
	TENSP NVARCHAR(200),
	MALOAI NCHAR(20) NOT NULL,
	MANCC NCHAR(20) NOT NULL,	
	GIA MONEY,
	MOTA NVARCHAR(1000),
	CONSTRAINT PK_SANPHAM PRIMARY KEY(MASP),
	CONSTRAINT FK_SP_LOAI FOREIGN KEY(MALOAI) REFERENCES LOAISANPHAM(MALOAI),
	CONSTRAINT FK_SP_NCC FOREIGN KEY(MANCC) REFERENCES NHACUNGCAP(MANCC)
)
CREATE TABLE KHACHHANG
(
	MAKH NCHAR(20) NOT NULL,
	TENKH NVARCHAR(50),
	GIOITINH NVARCHAR(50),
	DIACHI NVARCHAR(1000),
	TUOI INT,
	EMAIL NVARCHAR(100),
	DIENTHOAI INT,
	CONSTRAINT PK_KH PRIMARY KEY(MAKH)
	
)

CREATE TABLE NHANVIEN
(
	MANV NCHAR(20) NOT NULL,
	TENNV NVARCHAR(100),
	MACHINHANH NCHAR(20) NOT NULL,
	DIACHI NVARCHAR(100),
	SDT INT,
	EMAIL NVARCHAR(50),
	CHUCVU NVARCHAR(50),
	LUONG MONEY,
	CONSTRAINT PK_NV PRIMARY KEY(MANV),
	CONSTRAINT FK_NV_CHINHANH FOREIGN KEY(MACHINHANH) REFERENCES CHINHANH(MACHINHANH)

)

CREATE TABLE HOADON
(
	MAHD NCHAR(20) NOT NULL,
	MACHINHANH NCHAR(20) NOT NULL,
	MANV NCHAR(20) NOT NULL,
	MAKH NCHAR(20) NOT NULL,	
	NGAYBAN DATE,
	TONGTIEN FLOAT,
	CONSTRAINT PK_HD PRIMARY KEY(MAHD),
	CONSTRAINT FK_HD_CHINHANH FOREIGN KEY(MACHINHANH) REFERENCES CHINHANH(MACHINHANH),
	CONSTRAINT FK_HD_NV FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
	CONSTRAINT FK_HD_KH FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH)
	
)
CREATE TABLE CHITIETHD
(
	MAHD NCHAR(20) NOT NULL,
	MASP NCHAR(20) NOT NULL,	
	MAGG CHAR(20) NOT NULL,
	SL INT,
	GIA MONEY,
	THANHTIEN FLOAT,
	GHICHU NVARCHAR(1000),
	CONSTRAINT PK_CHITIETHD PRIMARY KEY(MAHD,MASP),
	CONSTRAINT FK_CTHD_HD FOREIGN KEY(MAHD) REFERENCES HOADON(MAHD),
	CONSTRAINT FK_CTHD_SP FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP),
	CONSTRAINT FK_CTHD_GIAMGIA FOREIGN KEY(MAGG) REFERENCES GIAMGIA(MAGG)
)


CREATE TABLE KHOHANG
(
	MACHINHANH NCHAR(20) NOT NULL,
	MASP NCHAR(20) NOT NULL,	
	SLTON INT,		
	GHICHU NVARCHAR(1000),
	CONSTRAINT PK_KHOHANG PRIMARY KEY(MACHINHANH,MASP),
	CONSTRAINT FK_KHOHANG_CHINHANH FOREIGN KEY(MACHINHANH) REFERENCES CHINHANH(MACHINHANH),
	CONSTRAINT FK_KHOHANG_SP FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)
)

SET DATEFORMAT DMY

INSERT INTO KHUVUC
VALUES ('KV01',N'Mi?n B?c'),
	   ('KV02',N'Mi?n Trung'),
	   ('KV03',N'Mi?n Nam')

INSERT INTO CHINHANH
VALUES ('CN01','KV01',N'HOÀNG QUÂN 1',N'Hà N?i'),
	   ('CN02','KV01',N'HOÀNG QUÂN 2',N'H?i Phòng'),
	   ('CN03','KV02',N'HOÀNG QUÂN 3',N'?à N?ng'),
	   ('CN04','KV03',N'HOÀNG QUÂN 4',N'Thành ph? H? Chí Minh'),
	   ('CN05','KV03',N'HOÀNG QUÂN 5',N'V?ng Tàu')
INSERT INTO NHACUNGCAP
VALUES ('NCC01',N'ABC',N'Hà N?i',0915245217),
	   ('NCC02',N'TTH',N'Hu?',0902596115),
	   ('NCC03',N'DDN',N'??ng Nai',0905345123)

INSERT INTO NHAPHANG
VALUES ('NH01','NCC01','CN01',100,'02/02/2021'),
	   ('NH02','NCC02','CN01',50,'02/03/2021'),
	   ('NH03','NCC02','CN03',100,'05/04/2021'),
	   ('NH04','NCC03','CN04',70,'02/05/2021'),
	   ('NH05','NCC03','CN05',120,'02/06/2021') 
INSERT INTO LOAISANPHAM
VALUES ('ML01',N'G?ch'),
	   ('ML02',N'?á'),
	   ('ML03',N'Thép'),
	   ('ML04',N'Xi m?ng.')
INSERT INTO GIAMGIA
VALUES ('GG01',0.05,NULL),
	   ('GG02',0.1,NULL),
	   ('GG03',0.2,NULL),
	   ('GG04',0.3,NULL),
	   ('GG05',0.5,NULL)
INSERT INTO SANPHAM
VALUES ('SP01',N'?á 5mm','ML02','NCC01',95000,NULL),
	   ('SP02',N'?á 3 mm','ML02','NCC03',95000,NULL),
       ('SP03',N'G?ch n?n','ML01','NCC03',200000,NULL),
	   ('SP04',N'G?ch S?','ML01','NCC01',560000,NULL),
	   ('SP05',N'Thép tr? 3cm','ML03','NCC02',650000,NULL),
	   ('SP06',N'Thép tr? 5cm','ML03','NCC02',95000,NULL),
	   ('SP07',N'Xi m?ng cát t??ng','ML04','NCC03',160000,NULL),
	   ('SP08',N'Xi m?ng h?i long','ML04','NCC02',50000,NULL)
INSERT INTO KHACHHANG
VALUES ('KH01',N'Anh Khang',N'nam',N'C?n th?',20,'khang123@gmail.com',0302457621),
	   ('KH02',N'Th? H?nh', N'n?',N'Khánh hòa',25,'hanh123@gmail.com',0908756894),
	   ('KH03',N'Trang Linh', N'n?',N'H?i Phòng',30,'linh123@gmail.com',0703692134),
	   ('KH04',N'Minh Quân', N'nam',N'Lào Cai',27,'quan123@gmail.com',0804258769),
	   ('KH05',N'M?ng Tuy?n', N'n?',N'H?i Phòng',20,'tuyen123@gmail.com',0908089999)
INSERT INTO NHANVIEN
VALUES ('NV01',N'Ng?c Hân','CN01',N'Hà n?i',0302852469,'han123@gmail.com',N'Qu?n lí tr??ng',7000000),
	   ('NV02',N'Ng?c Duyên', 'CN02',N'Hu?',0506258764,'duyen123@gmail.com',N'Qu?n lí tr??ng',7000000),
	   ('NV03',N'Anh Tu?n', 'CN02',N'?à N?ng',090784618,'tuan123@gmail.com',N'Nhân viên',5000000),
	   ('NV04',N'Hoàng V?', 'CN03',N'??ng nai',0355461287,'vu123@gmail.com',N'Qu?n lí tr??ng',7000000),
	   ('NV05',N'Ki?u Linh', 'CN03',N'Long an',0373164359,'linh123@gmail.com',N'Nhân viên',5000000)
INSERT INTO HOADON
VALUES ('HD01','CN02','NV02','KH01','03/03/2021',1425000),
	   ('HD02', 'CN02','NV03','KH04','10/03/2021',6550000 ),
	   ('HD03','CN03','NV05','KH02','20/02/2021',1200000),
	   ('HD04','CN03','NV01','KH05','25/02/2021',11200000),
	   ('HD05','CN03','NV04','KH03','07/03/2021',3250000)
INSERT INTO CHITIETHD
VALUES ('HD01','SP02','GG01',15,95000,1425000,NULL),
	   ('HD02','SP05','GG01',10,650000,6550000,NULL),
	   ('HD03','SP03','GG02',6,200000, 1200000,NULL),
	   ('HD04','SP01','GG03',20,95000,11200000,NULL),
	   ('HD05','SP01','GG04',5,95000,3250000,NULL)
INSERT INTO KHOHANG
VALUES ('CN01','SP01',150,NULL),
	   ('CN01','SP05',30,NULL),
	   ('CN02','SP04',50,NULL),
	   ('CN02','SP07',20,NULL),
	   ('CN03','SP02',20,NULL),
	   ('CN03','SP03',70,NULL),
	   ('CN02','SP05',15,NULL),
	   ('CN03','SP08',20,NULL),
	   ('CN02','SP06',10,NULL),
	   ('CN01','SP06',15,NULL)